<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "870a0086adbc313a8eea5489bdcb2522",
  "translation_date": "2025-08-24T12:01:18+00:00",
  "source_file": "2-Working-With-Data/05-relational-databases/README.md",
  "language_code": "ja"
}
-->
# データの操作: リレーショナルデータベース

|![ スケッチノート by [(@sketchthedocs)](https://sketchthedocs.dev) ](../../sketchnotes/05-RelationalData.png)|
|:---:|
| データの操作: リレーショナルデータベース - _スケッチノート by [@nitya](https://twitter.com/nitya)_ |

過去にスプレッドシートを使って情報を保存したことがあるかもしれません。スプレッドシートには行と列があり、行には情報（データ）が含まれ、列はその情報を説明します（メタデータと呼ばれることもあります）。リレーショナルデータベースは、この行と列のテーブルという基本原則に基づいて構築されており、情報を複数のテーブルに分散させることができます。これにより、より複雑なデータを扱い、重複を避け、データを柔軟に探索することが可能になります。リレーショナルデータベースの概念を見ていきましょう。

## [講義前クイズ](https://purple-hill-04aebfb03.1.azurestaticapps.net/quiz/8)

## すべてはテーブルから始まる

リレーショナルデータベースの中心にはテーブルがあります。スプレッドシートと同様に、テーブルは列と行の集合です。行には、都市名や降雨量など、扱いたいデータや情報が含まれています。列は保存されるデータを説明します。

まず、都市に関する情報を保存するテーブルを作成することから始めましょう。都市名と国名を保存することから始めることができます。以下のようにテーブルに保存できます。

| 都市       | 国           |
| ---------- | ------------ |
| 東京       | 日本         |
| アトランタ | アメリカ合衆国 |
| オークランド | ニュージーランド |

**都市**、**国**、**人口**という列名が保存されるデータを説明していることに注目してください。そして、各行には1つの都市に関する情報が含まれています。

## 単一テーブルアプローチの欠点

上記のテーブルは比較的馴染み深いものに見えるかもしれません。それでは、成長するデータベースに年間降雨量（ミリメートル単位）という追加データを加えてみましょう。2018年、2019年、2020年のデータに焦点を当てます。東京のデータを追加すると、次のようになります。

| 都市   | 国     | 年   | 降雨量 |
| ------ | ------ | ---- | ------ |
| 東京   | 日本   | 2020 | 1690   |
| 東京   | 日本   | 2019 | 1874   |
| 東京   | 日本   | 2018 | 1445   |

このテーブルについて何か気づきましたか？都市名と国名を何度も繰り返していることに気づくかもしれません。これではかなりのストレージを消費し、必要以上に重複してしまいます。結局のところ、東京には私たちが興味を持つ名前が1つしかありません。

では、別の方法を試してみましょう。各年の新しい列を追加してみます。

| 都市       | 国           | 2018 | 2019 | 2020 |
| ---------- | ------------ | ---- | ---- | ---- |
| 東京       | 日本         | 1445 | 1874 | 1690 |
| アトランタ | アメリカ合衆国 | 1779 | 1111 | 1683 |
| オークランド | ニュージーランド | 1386 | 942  | 1176 |

これにより行の重複を避けることができますが、いくつかの課題が追加されます。新しい年が追加されるたびにテーブルの構造を変更する必要があります。また、データが増えるにつれて、年を列として扱うと値の取得や計算が難しくなります。

これが、複数のテーブルとリレーションシップが必要な理由です。データを分割することで重複を避け、データを操作する際の柔軟性を高めることができます。

## リレーションシップの概念

データに戻り、どのように分割するかを決定しましょう。都市の名前と国を保存したいことはわかっているので、これは1つのテーブルに保存するのが最適です。

| 都市       | 国           |
| ---------- | ------------ |
| 東京       | 日本         |
| アトランタ | アメリカ合衆国 |
| オークランド | ニュージーランド |

しかし、次のテーブルを作成する前に、各都市を参照する方法を考える必要があります。何らかの識別子、ID、または（技術的なデータベース用語で言うと）主キーが必要です。主キーは、テーブル内の特定の行を識別するために使用される値です。これが値自体に基づいている場合（例えば都市名を使用することもできます）、ほとんどの場合、番号やその他の識別子であるべきです。IDが変更されるとリレーションシップが壊れるため、変更されないようにする必要があります。ほとんどの場合、主キーやIDは自動生成される番号になります。

> ✅ 主キーはしばしばPKと略されます

### cities

| city_id | 都市       | 国           |
| ------- | ---------- | ------------ |
| 1       | 東京       | 日本         |
| 2       | アトランタ | アメリカ合衆国 |
| 3       | オークランド | ニュージーランド |

> ✅ このレッスンでは「id」と「主キー」という用語を同じ意味で使用していることに注意してください。ここでの概念は、後で学ぶDataFrameにも適用されます。DataFrameでは「主キー」という用語は使用されませんが、ほぼ同じように動作することに気づくでしょう。

都市テーブルが作成されたので、降雨量を保存しましょう。都市に関する完全な情報を重複させる代わりに、IDを使用できます。また、新しく作成されたテーブルにも*id*列を追加する必要があります。すべてのテーブルにはIDまたは主キーが必要です。

### rainfall

| rainfall_id | city_id | 年   | 降雨量 |
| ----------- | ------- | ---- | ------ |
| 1           | 1       | 2018 | 1445   |
| 2           | 1       | 2019 | 1874   |
| 3           | 1       | 2020 | 1690   |
| 4           | 2       | 2018 | 1779   |
| 5           | 2       | 2019 | 1111   |
| 6           | 2       | 2020 | 1683   |
| 7           | 3       | 2018 | 1386   |
| 8           | 3       | 2019 | 942    |
| 9           | 3       | 2020 | 1176   |

新しく作成された**rainfall**テーブル内の**city_id**列に注目してください。この列には、**cities**テーブル内のIDを参照する値が含まれています。技術的なリレーショナルデータ用語では、これを**外部キー**と呼びます。他のテーブルの主キーです。単に参照またはポインタと考えることができます。**city_id** 1は東京を参照しています。

> [!NOTE] 外部キーはしばしばFKと略されます

## データの取得

データを2つのテーブルに分割した状態で、どのようにデータを取得するのか疑問に思うかもしれません。MySQL、SQL Server、Oracleなどのリレーショナルデータベースを使用している場合、Structured Query Language（SQL）と呼ばれる言語を使用できます。SQL（シークエルと発音されることもあります）は、リレーショナルデータベース内のデータを取得および変更するために使用される標準言語です。

データを取得するには、`SELECT`コマンドを使用します。基本的には、**表示したい列を選択し**、それらが含まれている**テーブルを指定**します。都市名だけを表示したい場合、次のように記述できます。

```sql
SELECT city
FROM cities;

-- Output:
-- Tokyo
-- Atlanta
-- Auckland
```

`SELECT`は列をリストする場所であり、`FROM`はテーブルをリストする場所です。

> [NOTE] SQLの構文は大文字小文字を区別しないため、`select`と`SELECT`は同じ意味です。ただし、使用しているデータベースの種類によっては、列やテーブルが大文字小文字を区別する場合があります。そのため、プログラミングでは常にすべてを大文字小文字を区別するものとして扱うのがベストプラクティスです。SQLクエリを書く際の一般的な慣例は、キーワードをすべて大文字で記述することです。

上記のクエリはすべての都市を表示します。ニュージーランドの都市だけを表示したいと想像してみてください。何らかのフィルターが必要です。SQLキーワードではこれを`WHERE`、つまり「条件が真である場合」と呼びます。

```sql
SELECT city
FROM cities
WHERE country = 'New Zealand';

-- Output:
-- Auckland
```

## データの結合

これまで、単一のテーブルからデータを取得してきました。次に、**cities**と**rainfall**の両方からデータを結合して取得したいと思います。これは*結合*によって行われます。2つのテーブルの間に接続を作成し、それぞれのテーブルの列の値を一致させます。

この例では、**rainfall**の**city_id**列と**cities**の**city_id**列を一致させます。これにより、降雨量の値がそれぞれの都市と一致します。実行する結合の種類は*内部結合*と呼ばれ、他のテーブルと一致しない行がある場合、それらは表示されません。この場合、すべての都市に降雨量があるため、すべてが表示されます。

すべての都市の2019年の降雨量を取得してみましょう。

これを段階的に行います。最初のステップは、**city_id**で示される列を指定して、データを結合することです。

```sql
SELECT cities.city
    rainfall.amount
FROM cities
    INNER JOIN rainfall ON cities.city_id = rainfall.city_id
```

結合したい2つの列と、**city_id**でテーブルを結合したいことを示しました。次に、`WHERE`ステートメントを追加して2019年のデータだけをフィルタリングします。

```sql
SELECT cities.city
    rainfall.amount
FROM cities
    INNER JOIN rainfall ON cities.city_id = rainfall.city_id
WHERE rainfall.year = 2019

-- Output

-- city     | amount
-- -------- | ------
-- Tokyo    | 1874
-- Atlanta  | 1111
-- Auckland |  942
```

## まとめ

リレーショナルデータベースは、情報を複数のテーブルに分割し、それを表示や分析のために再結合することを中心にしています。これにより、計算を行ったり、データを操作したりする際の柔軟性が非常に高まります。リレーショナルデータベースの基本概念と、2つのテーブル間で結合を行う方法を学びました。

## 🚀 チャレンジ

インターネット上には多数のリレーショナルデータベースがあります。学んだスキルを使ってデータを探索してみてください。

## 講義後クイズ

## [講義後クイズ](https://purple-hill-04aebfb03.1.azurestaticapps.net/quiz/9)

## 復習と自己学習

SQLやリレーショナルデータベースの概念をさらに探求するために、[Microsoft Learn](https://docs.microsoft.com/learn?WT.mc_id=academic-77958-bethanycheum)にはいくつかのリソースがあります。

- [リレーショナルデータの概念を説明する](https://docs.microsoft.com//learn/modules/describe-concepts-of-relational-data?WT.mc_id=academic-77958-bethanycheum)
- [Transact-SQLでクエリを開始する](https://docs.microsoft.com//learn/paths/get-started-querying-with-transact-sql?WT.mc_id=academic-77958-bethanycheum) (Transact-SQLはSQLのバージョンです)
- [Microsoft LearnのSQLコンテンツ](https://docs.microsoft.com/learn/browse/?products=azure-sql-database%2Csql-server&expanded=azure&WT.mc_id=academic-77958-bethanycheum)

## 課題

[課題タイトル](assignment.md)

**免責事項**:  
この文書は、AI翻訳サービス [Co-op Translator](https://github.com/Azure/co-op-translator) を使用して翻訳されています。正確性を追求しておりますが、自動翻訳には誤りや不正確な表現が含まれる可能性があることをご承知おきください。原文（元の言語で記載された文書）が信頼できる情報源として優先されるべきです。重要な情報については、専門の人間による翻訳をお勧めします。本翻訳の使用に起因する誤解や誤認について、当方は一切の責任を負いません。